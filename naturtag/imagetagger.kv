#:kivy 1.11
#:import IMAGE_FILETYPES naturtag.ui.IMAGE_FILETYPES
#:set header_color .3, .3, .37
#:set filechooser_color .15, .15, .15

<ConfigCheckBox@CheckBox>:
	size_hint_x: .2
	size_hint_y: .2

<ConfigLabel@Label>:
	size_hint_y: .2
	text_size: self.size

<ConfigTextInput@TextInput>:
	multiline: False
	size_hint_max_y: 25

<HeaderBoxLayout@BoxLayout>:
	canvas.before:
		Color:
			rgb: header_color
		Rectangle:
			pos: self.pos
			size: self.size

<HeaderLabel@Label>:
	size_hint_y: .1
	size_hint_min_y: 10
	size_hint_max_y: 20

<Controller>:
    common_names: common_names_chk.active
    hierarchical_keywords: hierarchical_keywords_chk.active
    darwincore: darwincore_chk.active
	create_xmp: create_xmp_chk.active
    observation_id: observation_id_input.text
    taxon_id: taxon_id_input.text

	canvas.before:
        Color:
            rgb: .8, .8, .8
        Rectangle:
			pos: self.pos
            size: self.size

	# Image viewer
	ScrollView:
		do_scroll_x: False
		do_scroll_y: True
		effect_cls: "OpacityScrollEffect"
		scroll_type: ['bars', 'content']
		scroll_wheel_distance: 40
		size: self.size
		bar_width: 10

		GridLayout:
			id: image_previews
			size_hint_y: None
			cols: int(self.width / 200)

	# Options + file chooser
	BoxLayout:
		orientation: "vertical"
		size_hint_x: .4
		size_hint_min_x: 450

		# Options
		HeaderBoxLayout:
			size_hint_y: .15
			size_hint_min_y: 100

			# Checkboxes
			GridLayout:
				cols: 2

				ConfigCheckBox:
                    id: common_names_chk
					active: True
				ConfigLabel:
					text: "Common Names"
				ConfigCheckBox:
                    id: hierarchical_keywords_chk
					active: True
				ConfigLabel:
					text: "Hierarchical Keywords"
				ConfigCheckBox:
					id: darwincore_chk
					active: True
				ConfigLabel:
					text: "Darwin Core Metadata"
				ConfigCheckBox:
                    id: create_xmp_chk
				ConfigLabel:
					text: "Create XMP Files"

			# Text input fields
			GridLayout:
				cols: 2

				ConfigLabel:
					text: "Observation ID"
				ConfigTextInput:
                    id: observation_id_input
				ConfigLabel:
					text: "Taxon ID"
				ConfigTextInput:
                    id: taxon_id_input

		# File Chooser
		BoxLayout:
			orientation: "vertical"
            canvas.before:
                Color:
                    rgb: filechooser_color
                Rectangle:
                    pos: self.pos
                    size: self.size

			FileChooserListView::q
				id: filechooser
				filters: IMAGE_FILETYPES
				# multiselect: True
				# dirselect: True
				on_selection: root.add_images(self.selection)

			# List of selected files
			HeaderBoxLayout:
				orientation: "vertical"

				HeaderLabel:
					text: "Selected Files:"
				TextInput:
					text: root.file_list_text
					id: file_input
					readonly: True
					multiline: True
					size_hint_y: .3

			BoxLayout:
				size_hint_y: None
				height: 30

				Button:
					text: "Clear"
					on_release: root.reset()
                Button:
                    text: "Debug"
                    on_release: root.get_state()
				Button:
					text: "Load"
					on_release: root.add_images(filechooser.selection)

<Picture>:
    on_size: self.center = win.Window.center
    size: image.size
    size_hint: None, None

    Image:
        id: image
        source: root.source
        size: 200, 200 / self.image_ratio

        # add shadow background
#        canvas.before:
#            Color:
#                rgba: 1,1,1,1
#            BorderImage:
#                source: 'shadow32.png'
#                border: (36,36,36,36)
#                size:(self.width+72, self.height+72)
#                pos: root.pos
