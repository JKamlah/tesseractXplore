<ImageSelectionScreen>:
    name: 'tesseract_xplore'
    #name: 'image_selection'

    FloatLayout:
        id: layout
        # Right-click context menu for images
        PhotoContextMenu:
            id: context_menu
            cancel_handler_widget: layout
        BoxLayout:
            orientation: 'vertical'
            BoxLayout:
                # Image viewer
                ScrollViewY:
                    MDGridLayout:
                        id: image_previews
                        adaptive_height: True
                        cols: max(int(self.width / 200), 1)
                        padding: dp(4), dp(4)
                        spacing: dp(4)
                        row_default_height: 200
                        col_default_width: 200
                        col_force_default: True

                # Options + file chooser
                MDBoxLayout:
                    orientation: 'vertical'
                    size_hint_x: .4
                    size_hint_min_x: 450

                    # Text input fields
                    # TODO: Move input/search to a separate screen
                    MDBoxLayout:
                        size_hint_y: .50
                        size_hint_min_y: 120

                        MDGridLayout:
                            cols: 1
                            spacing: dp(4)

                            OneLineListItem:
                                font_style: 'H5'
                                markup: True
                                text: '[size=21]Tesseract [b]Settings[/b][/size]'
                                on_release: app.tesseract_controller.reset_settings()

                            MDDropDownItem:
                                id: model
                                text: 'Select model (defautl:eng)'
                                on_release: app.tesseract_controller.model_menu.open()

                            MDDropDownItem:
                                id: psm
                                text: 'Select PSM (default:3)'
                                on_release: app.tesseract_controller.psm_menu.open()

                            MDDropDownItem:
                                id: oem
                                text: 'Select OEM (default:3)'
                                on_release: app.tesseract_controller.oem_menu.open()

                            MDDropDownItem:
                                id: outputformat
                                text: 'Select outputformat (default:txt)'
                                on_release: app.tesseract_controller.outputformat_menu.open()

                            MDDropDownItem:
                                id: output
                                text: "Select output folder (default:inputfolder)"
                                width: dp(400)
                                icon: 'folder'
                                pos_hint:{'center_x':0.5,'center_y':0.7}
                                on_release: app.tesseract_controller.select_output_folder()

                            MDRoundFlatIconButton:
                                text: 'Find a new model'
                                disabled: True
                                icon: 'find'
                                width: dp(200)
                                on_press:
                                    app.switch_screen('taxon')
                            MDLabel:
                                id: taxon_id_input
                                disabled: True
                                hint_text: 'Taxon ID'
                                helper_text: 'Enter an iNaturalist taxon ID'
                            #MDRoundFlatIconButton:
                            #    disabled: True  # TODO: Remove once implemented
                            #    text: 'Find an Observation'
                            #    icon: 'crosshairs-gps'
                            #    width: dp(200)
                            #    on_press:
                            #       app.switch_screen('observation')
                            MDLabel:
                                id: observation_id_input
                                disabled: True
                                hint_text: 'Observation ID'
                                helper_text: 'Enter an iNaturalist observation ID'



                    # File Chooser
                    MDBoxLayout:
                        orientation: 'vertical'
                        md_bg_color: .1, .1, .1, .75

                        OneLineListItem:
                            font_style: 'H5'
                            markup: True
                            text: '[size=21]Image [b]Selection[/b][/size]'

                        FileChooserListView:
                            id: file_chooser
                            dirselect: True
                            filters: IMAGE_FILETYPES

                        # Buttons; TODO: Make this less ugly
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(50)
                            spacing: dp(5)

                            MDRaisedButton:
                                id: clear_button
                                text: 'Clear'
                                height: dp(50)
                                theme_text_color: 'Primary'
                                md_bg_color: app.theme_cls.primary_dark
                            #MDRaisedButton:
                            #    id: debug_button
                            #    text: 'Debug'
                            #    md_bg_color: app.theme_cls.primary_dark
                            MDRaisedButton:
                                id: load_button
                                text: 'Load Selected File/Folder'
                                height: dp(50)
                                theme_text_color: 'Primary'
                                md_bg_color: app.theme_cls.primary_dark
                            MDBoxLayout:
                                md_bg_color: app.theme_cls.primary_dark
                                adaptive_height: True
                                padding: dp(10), dp(0)
                                MDSwitch:
                                    id: recursive_chk
                                MDLabel:
                                    text: 'Recursive'
                                    halign: 'center'
                                    font_style: 'Button'
                                    theme_text_color: 'ContrastParentBackground'
            StatusBar:
                id: status_bar


        MDGridLayout:
            cols: 2
            spacing: dp(4)
            padding: dp(4)

            MDFloatingActionButton:
                id: recognize_button
                icon: 'play'
                elevation_normal: 8
                md_bg_color: app.theme_cls.primary_dark
                halign: "bottom"
            AnchorLayout:
                anchor_y: 'bottom'
                anchor_x: 'left'
                MDFloatingActionButton:
                    id: pause_button
                    icon: 'pause'
                    disabled: True
                    elevation_normal: 8
                    md_bg_color: app.theme_cls.primary_dark
