#: import ObjectContextMenu tesseractXplore.widgets.ListItemWithCheckbox

<ListItemWithCheckbox>:
    RightCheckbox:

<ImageSelectionScreen>:
    name: 'tesseract_xplore'
    #name: 'image_selection'

    FloatLayout:
        id: layout
        # Right-click context menu for images
        PhotoContextMenu:
            id: context_menu
            cancel_handler_widget: layout
        BoxLayout:
            orientation: 'vertical'
            BoxLayout:
                # Image viewer
                ScrollViewY:
                    id: image_scrollview
                    MDGridLayout:
                        id: image_previews
                        adaptive_height: True
                        cols: max(int(self.width / 200), 1)
                        padding: dp(4), dp(4)
                        spacing: dp(4)
                        row_default_height: 200
                        col_default_width: 200
                        col_force_default: True

                # Options + file chooser
                MDBoxLayout:
                    orientation: 'vertical'
                    size_hint_x: .4
                    size_hint_min_x: 450

                    # Text input fields
                    # TODO: Move input/search to a separate screen
                    MDBoxLayout:
                        size_hint_y: 0.9
                        size_hint_min_y: 120

                        MDGridLayout:
                            cols: 1
                            spacing: dp(4)
                            OneLineListItem:
                                id: settings_menu
                                font_style: 'H5'
                                markup: True
                                text: '[size=21]Tesseract [b]Settings[/b][/size]'
                                on_release: app.tesseract_controller.reset_settings()
                                #settings_menu()

                            MDDropDownItem:
                                id: model
                                text: 'Select model (default: eng)'
                                #on_release: app.tesseract_controller.show_example_grid_bottom_sheet()
                                #app.tesseract_controller.model_menu.open()

                            MDDropDownItem:
                                id: psm
                                text: 'Select PSM (default: 3)'
                                on_release: app.tesseract_controller.psm_menu.open()

                            MDDropDownItem:
                                id: oem
                                text: 'Select OEM (default: 3)'
                                on_release: app.tesseract_controller.oem_menu.open()

                            MDBoxLayout:
                                orientation: 'vertical'
                                adaptive_height: True
                                #size_y: dp(60)
                                #size_hint_min_y: dp(60)
                                col:2
                                MDBoxLayout:
                                    size_hint_y: None
                                    height: dp(30)
                                    MDLabel:
                                        text: ' Select Ouputformat (default: stdout)'
                                        theme_text_color: 'Primary'
                                MDBoxLayout:
                                    orientation: 'horizontal'
                                    adaptive_height: True
                                    ItemLabel:
                                        text: 'TXT '
                                    MDSwitch:
                                        id: txt
                                        width: dp(8)
                                    ItemLabel:
                                        text: 'HOCR '
                                    MDSwitch:
                                        id: hocr
                                        width: dp(8)
                                    ItemLabel:
                                        text: 'ALTO '
                                    MDSwitch:
                                        id: alto
                                        width: dp(8)
                                    ItemLabel:
                                        text: 'PDF '
                                    MDSwitch:
                                        id: pdf
                                        width: dp(8)
                                    ItemLabel:
                                        text: 'TSV '
                                    MDSwitch:
                                        id: tsv
                                        halign: 'center'
                                        width: dp(8)
                                    ItemLabel:
                                        text: ''

                            MDBoxLayout:
                                orientation: 'horizontal'
                                adaptive_height: True
                                col: 2
                                OneLineAvatarIconListItem:
                                    text: 'Subfolder'
                                    height: dp(50)
                                    width: dp(400)
                                    SwitchListItem:
                                        id: subfolder_chk
                                MDTextField:
                                    id: groupfolder
                                    hint_text: 'Groupfolder'

                            MDDropDownItem:
                                id: output
                                text: 'Select output folder (default: input folder)'
                                width: dp(400)

                                icon: 'folder'
                                #pos_hint:{'center_x':0.5,'center_y':0.7}
                                on_release: app.tesseract_controller.select_output_folder()
                            MDGridLayout:
                                orientation: 'horizontal'
                                cols: 2
                                MDRoundFlatIconButton:
                                    text: 'Find a new model'
                                    disabled: False
                                    icon: 'find'
                                    width: dp(200)
                                    on_press:
                                        app.switch_screen('model')
                                MDRoundFlatIconButton:
                                    text: 'Train a model'
                                    disabled: True
                                    icon: 'find'
                                    width: dp(200)
                                    on_press:
                                        app.switch_screen('model')
                            MDLabel:
                                id: model_id_input
                                disabled: True
                                hint_text: 'Model ID'
                                helper_text: 'Enter an iNaturalist model ID'
                            #MDRoundFlatIconButton:
                            #    disabled: True  # TODO: Remove once implemented
                            #    text: 'Find an GT'
                            #    icon: 'crosshairs-gps'
                            #    width: dp(200)
                            #    on_press:
                            #       app.switch_screen('gt')
                            MDLabel:
                                id: gt_id_input
                                disabled: True
                                hint_text: 'GT ID'
                                helper_text: 'Enter an iNaturalist gt ID'



                    # File Chooser
                    MDBoxLayout:
                        orientation: 'vertical'
                        md_bg_color: .1, .1, .1, .75

                        OneLineListItem:
                            font_style: 'H5'
                            markup: True
                            text: '[size=21]Image [b]Selection[/b][/size]'

                        FileChooserListView:
                            id: file_chooser
                            dirselect: True
                            filters: IMAGE_FILETYPES

                        # Buttons; TODO: Make this less ugly
                        MDBoxLayout:
                            size_hint_y: None
                            height: dp(50)
                            spacing: dp(5)
                            #MDRaisedButton:
                            #    id: debug_button
                            #    text: 'Debug'
                            #    md_bg_color: app.theme_cls.primary_dark
                            MDRaisedButton:
                                id: load_button
                                text: 'Load Selected File/Folder'
                                height: dp(50)
                                theme_text_color: 'Primary'
                                md_bg_color: app.theme_cls.primary_dark
                            MDBoxLayout:
                                md_bg_color: app.theme_cls.primary_dark
                                adaptive_height: True
                                padding: dp(10), dp(0)
                                MDSwitch:
                                    id: recursive_chk
                                MDLabel:
                                    text: 'Recursive'
                                    halign: 'center'
                                    font_style: 'Button'
                                    theme_text_color: 'ContrastParentBackground'
            StatusBar:
                id: status_bar


        MDBoxLayout:
            cols: 4
            spacing: dp(4)
            padding: dp(4)


            ControlTooltipButton:
                id: recognize_button
                icon: 'play'
                elevation_normal: 8
                md_bg_color: app.theme_cls.primary_dark
                tooltip_text: 'Recognize all'
                halign: 'bottom'

            ControlTooltipButton:
                id: pause_button
                icon: 'pause'
                tooltip_text: 'Cancel recognition'
                disabled: True
                elevation_normal: 8
                md_bg_color: app.theme_cls.primary_dark

            ControlTooltipButton:
                id: clear_button
                icon: 'trash-can'
                tooltip_text: 'Clear image selection'
                md_bg_color: app.theme_cls.primary_dark

            ControlTooltipButton:
                id: sort_button
                icon: 'sort'
                text: 'Sort Up'
                tooltip_text: 'Sort image selection'
                md_bg_color: app.theme_cls.primary_dark

            ControlTooltipButton:
                id: zoomin_button
                icon: 'magnify-plus'
                tooltip_text: 'Zoom in'
                md_bg_color: app.theme_cls.primary_dark

            ControlTooltipButton:
                id: zoomout_button
                icon: 'magnify-minus'
                tooltip_text: 'Zoom out'
                md_bg_color: app.theme_cls.primary_dark

