#:import TaxonAutocompleteSearch naturtag.ui.taxon_selection_controller.TaxonAutocompleteSearch
#:import CachedAsyncImage naturtag.ui.image.CachedAsyncImage
#:import RANKS naturtag.constants.RANKS


<TaxonScreen>:
    name: 'taxon'

    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            # Taxon selection: search, history, etc.
            MDTabs:
                id: taxon_selection_tabs
                size_hint_x: .4
                size_hint_min_x: dp(500)
                size_hint_max_x: dp(700)
                background_color: app.theme_cls.primary_color
                TaxonSearchTab:
                    id: search_tab
                TaxonHistoryTab:
                    id: history_tab
                FrequentTaxaTab:
                    id: frequent_tab
                StarredTaxaTab:
                    id: starred_tab

            # Info display for selected taxon
            MDBoxLayout:
                orientation: 'vertical'
                padding: dp(20)
                md_bg_color: app.theme_cls.bg_dark
                MDGridLayout:
                    cols: 2
                    spacing: dp(10)
                    size_hint_y: .7
                    size_hint_min_y: dp(300)
                    size_hint_max_y: dp(650)
                    MDBoxLayout:
                        orientation: 'vertical'
                        spacing: dp(10)
                        size_hint_max_x: dp(500)
                        CachedAsyncImage:
                            id: selected_taxon_photo
                            size_hint_max_y: dp(500)
                    MDBoxLayout:
                        size_hint_max_x:  dp(500)
                        orientation: 'vertical'
                        ScrollViewY:
                            MDList:
                                id: basic_info_section
                        LinksSection:
                            id: taxon_links
                TaxonomySection:
                    id: taxonomy_section
        StatusBar:
            id: status_bar


<SectionHeader@MDLabel>:
    font_style: 'H6'
    theme_text_color: 'Primary'
    size_hint_max_y: dp(60)


<InputLabel@MDLabel>:
    theme_text_color: 'Primary'
    size_hint_max_x: dp(100)
    size_hint_max_y: dp(50)

# Taxon search tab
<TaxonSearchTab@Tab>:
    text: 'magnify'
    # tooltip_text: 'Search'
    orientation: 'vertical'
    padding: dp(20)
    OneLineListItem:
        font_style: 'H5'
        text: 'Search'
    IntField:
        id: taxon_id_input
        hint_text: 'Taxon ID'
        helper_text: 'Enter an iNaturalist taxon ID'
    TaxonAutocompleteSearch:
        id: taxon_search_input
    SectionHeader:
        text: 'Categories'
    IconicTaxaLayout:
        id: iconic_taxa
    SectionHeader:
        text: 'Rank'
    MDGridLayout:
        cols: 2
        InputLabel:
            text: 'Exact'
        MDTextField:
            id: exact_rank_input
            readonly: True
            hint_text: 'Exact rank'
        InputLabel:
            text: 'Minimum'
        MDTextField:
            id: min_rank_input
            hint_text: 'Min rank'
        InputLabel:
            text: 'Maximum'
        MDTextField:
            id: max_rank_input
            hint_text: 'Max rank'
    MDBoxLayout:
        spacing: dp(10)
        TooltipIconButton:
            id: taxon_search_button
            icon: 'magnify'
            text: 'Search'
            width: dp(220)
        TooltipIconButton:
            id: reset_search_button
            icon: 'restart'
            text: 'Reset Filters'
            width: dp(220)
    # Temp spacer
    MDBoxLayout:
        height: 300

# Autocomplete search layout with input + dropdown
<TaxonAutocompleteSearch>:
    input: input
    dropdown: dropdown
    size_hint_x: 1
    SearchInput:
        id: input
        hint_text: 'Taxon Name'
        helper_text: 'Enter a scientific or common name'
        helper_text_mode: 'on_focus'
#        icon_right: 'close-circle-outline'  # TODO: Is there an event for this to bind to?
    AutocompleteDropdown:
        id: dropdown

 # Iconic taxa 'Categories' selector
<IconicTaxaLayout@MDGridLayout>:
    adaptive_size: True
    md_bg_color: app.theme_cls.bg_dark
    cols: 6
    padding: dp(10), dp(10)
    spacing: dp(20)
    row_default_height: dp(40)
    row_force_default: True
    col_default_width: dp(40)
    col_force_default: True

# Taxon links
<LinksSection@MDBoxLayout>:
    size_hint_max_y: dp(50)
    spacing: dp(10)
    TooltipIconButton:
        id: taxon_parent_button
        icon: 'arrow-up-circle-outline'
        text: 'View parent'
        width: dp(220)
        disabled: True
    TooltipIconButton:
        id: selected_taxon_link_button
        icon: 'link-variant'
        text: 'View on iNaturalist'
        width: dp(220)
        disabled: True

# Taxon ancestors & children
<TaxonomySection@MDGridLayout>:
    cols: 2
    # Labels: These will be updated with # of ancestors & children
    OneLineListItem:
        id: taxon_ancestors_label
        font_style: 'H5'
    OneLineListItem:
        id: taxon_children_label
        font_style: 'H5'
    # Result lists
    ScrollViewY:
        size_hint_max_x: dp(500)
        MDList:
            id: taxon_ancestors
    ScrollViewY:
        size_hint_max_x: dp(500)
        MDList:
            id: taxon_children
