#:import TaxonAutocompleteSearch naturtag.ui.search_controller.TaxonAutocompleteSearch
#:import CachedAsyncImage naturtag.ui.search_controller.CachedAsyncImage

<TaxonSearchScreen>:
    id: taxon_search_screen
    name: 'taxon_search'

    BoxLayout:
        # Search inputs
        MDBoxLayout:
            orientation: 'vertical'
            size_hint_x: .4
            size_hint_min_x: dp(500)
            size_hint_max_x: dp(700)
            md_bg_color: app.theme_cls.bg_light
            MDIntField:
                id: taxon_id_input
                hint_text: 'Taxon ID'
                helper_text: 'Enter an iNaturalist taxon ID'
            TaxonAutocompleteSearch:
                id: taxon_search_input
            MDLabel:
                text: 'Categories'
                font_style: 'H6'
                size_hint_max_y: dp(60)
            IconicTaxaLayout:
                id: iconic_taxa

            # Temp spacer
            MDBoxLayout:
                height: 300

        # Info display for selected taxon
        MDBoxLayout:
            orientation: 'vertical'
            md_bg_color: app.theme_cls.bg_darkest
            MDGridLayout:
                md_bg_color: app.theme_cls.bg_light
                cols: 2
                spacing: dp(10)
                # Taxon photo + link
                MDBoxLayout:
                    orientation: 'vertical'
                    spacing: dp(10)
                    size_hint_max_x: dp(500)
                    CachedAsyncImage:
                        id: selected_taxon_photo
                        size_hint_max_y: dp(500)
                    TooltipIconButton:
                        id: selected_taxon_link_button
                        icon: 'link-variant'
                        text: 'View on iNaturalist'
                        size_hint_x: 1
                # Name, rank, and other basic attributes
                MDList:
                    id: selected_taxon_basic_info
            # Taxonomy
            ImageScrollView:
                MDBoxLayout:
                    MDLabel:
                        theme_text_color: 'Primary'
                        font_style: 'H5'
                        text: 'Parents'
                    MDLabel:
                        id: selected_taxon_ancestors
                        theme_text_color: 'Primary'
                    MDLabel:
                        theme_text_color: 'Primary'
                        font_style: 'H5'
                        text: 'Children'
                    MDLabel:
                        id: selected_taxon_children
                        theme_text_color: 'Primary'

# Autocomplete search layout with input + dropdown
<TaxonAutocompleteSearch>:
    input: input
    dropdown: dropdown
    size_hint_x: 1
    SearchInput:
        id: input
        hint_text: 'Taxon Name'
        helper_text: 'Enter a scientific or common name'
        helper_text_mode: 'on_focus'
    AutocompleteDropdown:
        id: dropdown

 # Iconic taxa 'Categories' selector
<IconicTaxaLayout@MDGridLayout>:
    adaptive_size: True
    md_bg_color: app.theme_cls.bg_darkest
    cols: 6
    padding: dp(10), dp(10)
    spacing: dp(20)
    row_default_height: dp(32)
    row_force_default: True
    col_default_width: dp(32)
    col_force_default: True
